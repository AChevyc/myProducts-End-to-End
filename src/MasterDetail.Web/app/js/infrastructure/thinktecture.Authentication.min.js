var tt=window.tt||{};tt.authentication={},tt.authentication.constants={authenticationRequired:"tt:authentication:authNRequired",loginConfirmed:"tt:authentication:loginConfirmed",loginFailed:"tt:authentication:loginFailed",loggedIn:"tt:authentication:loggedIn",logoutConfirmed:"tt:authentication:logoutConfirmed"},tt.authentication.module=angular.module("tt.Authentication",["ng"]),tt.authentication.module.factory("authenticationService",["$rootScope","$injector","$q",function(n,t,i){function s(n,i,u){var f="Basic "+tt.Base64.encode(i+":"+u);return r=r||t.get("$http"),r.defaults.headers.common.Authorization=f,r.get(n+"api/controller/token").success(function(n){i="",u="",f="",o(n),c()})}function h(){u.nuke(),n.tt.authentication.userLoggedIn=!1,n.$broadcast(tt.authentication.constants.logoutConfirmed)}function c(){n.tt.authentication.userLoggedIn=!0,n.$broadcast(tt.authentication.constants.loggedIn),n.$broadcast(tt.authentication.constants.loginConfirmed)}function e(){l().then(function(t){return n.tt.authentication.userLoggedIn=!1,t?(new Date).getTime()>t.token.expiration?(n.$broadcast(tt.authentication.constants.authenticationRequired),!1):(o(t.token),n.tt.authentication.userLoggedIn=!0,n.$broadcast(tt.authentication.constants.loggedIn),!0):(n.$broadcast(tt.authentication.constants.authenticationRequired),!1)})}function o(n){var e=(new Date).getTime()+(n.expires_in-5)*1e3,i="Session "+n.access_token;r=r||t.get("$http"),r.defaults.headers.common.Authorization=i,$(document).ajaxSend(function(n,t){t.setRequestHeader("Authorization",i)}),n.expiration=e,u.save({key:f,token:n},"")}function l(){var n=i.defer();return u.get(f,function(t){n.resolve(t)}),n.promise}var r,u=new Lawnchair({adapter:"dom",table:"authenticationToken"},function(){}),f="tt:authentication:authNToken";return n.tt=n.tt||{},n.tt.authentication=n.tt.authentication||{},n.tt.authentication.userLoggedIn=!1,e(),{login:s,logout:h,checkForValidToken:e}}]),tt.authentication.module.config(["$httpProvider",function(n){var t=["$rootScope","$q","authenticationService",function(n,t,i){function u(n){return n}function f(n){return n.status===401&&r(t.defer()),t.reject(n)}function r(t){return n.tt.authentication.userLoggedIn=!1,i.checkForValidToken()?n.$broadcast(tt.authentication.constants.authenticationRequired):n.$broadcast(tt.authentication.constants.loginFailed),t.promise}return $.ajaxPrefilter(function(n){var t=n.error;n.error=function(n,i,u){return n.status===401&&r($.Deferred()),t?t(n,i,u):null}}),function(n){return n.then(u,f)}}];n.responseInterceptors.push(t)}]),tt.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){var f="",e,t,i,s,h,o,r,u=0;for(n=tt.Base64._utf8_encode(n);u<n.length;)e=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),s=e>>2,h=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),f=f+this._keyStr.charAt(s)+this._keyStr.charAt(h)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return f},decode:function(n){var t="",e,o,s,h,u,r,f,i=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)h=this._keyStr.indexOf(n.charAt(i++)),u=this._keyStr.indexOf(n.charAt(i++)),r=this._keyStr.indexOf(n.charAt(i++)),f=this._keyStr.indexOf(n.charAt(i++)),e=h<<2|u>>4,o=(u&15)<<4|r>>2,s=(r&3)<<6|f,t=t+String.fromCharCode(e),r!=64&&(t=t+String.fromCharCode(o)),f!=64&&(t=t+String.fromCharCode(s));return tt.Base64._utf8_decode(t)},_utf8_encode:function(n){var i,r,t;for(n=n.replace(/\r\n/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},_utf8_decode:function(n){for(var r="",t=0,i=c1=c2=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(c2=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|c2&63),t+=2):(c2=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(c2&63)<<6|c3&63),t+=3);return r}};
//@ sourceMappingURL=thinktecture.Authentication.min.js.map