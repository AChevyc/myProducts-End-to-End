angular.module("tt.Authentication.Services",["tt.Authentication.Internal"]).factory("authService",["$rootScope","$injector","$q","httpBuffer",function(n,t,i,r){var f=new Lawnchair({adapter:"dom",table:"authenticationToken"},function(){}),e="tt:authNToken",u;return{authenticate:function(n,i){var r="Basic "+Base64.encode(n+":"+i);u=u||t.get("$http"),u.defaults.headers.common.Authorization=r,u.get(ttTools.baseUrl+"api/token").success(function(t){n="",i="",r="",this.setToken(t),this.authenticationSuccess()})},authenticationSuccess:function(){n.$broadcast("tt:authNConfirmed"),r.retry()},setToken:function(n){var r=(new Date).getTime()+(n.expires_in-5)*1e3,i="Session "+n.access_token;u=u||t.get("$http"),u.defaults.headers.common.Authorization=i,$(document).ajaxSend(function(n,t){t.setRequestHeader("Authorization",i)}),n.expiration=r,f.save({key:e,token:n},"")},getToken:function(){var n=i.defer();return f.get(e,function(t){n.resolve(t)}),n.promise}}}]),angular.module("tt.Authentication.Providers",["tt.Authentication.Services","tt.Authentication.Internal"]).config(["$httpProvider",function(n){var t=["$rootScope","$q","authService","httpBuffer",function(n,t,i,r){function e(n){return n}function o(n){if(n.status===401){var i=t.defer();return u(n,i)}return t.reject(n)}function u(t,u){i.getToken().then(function(f){return r.append(t,u),f?(new Date).getTime()>f.token.expiration?(n.$broadcast("tt:authNRequired"),u.promise):(i.setToken(f.token),r.retry(),u.resolve(t)):(n.$broadcast("tt:authNRequired"),u.promise)})}var f=0;return $.ajaxPrefilter(function(t){var i=t.error,r=t;t.error=function(t,e,o){if(t.status===401){var s=$.Deferred();f++,n.$apply(u(r,s))}return i(t,e,o)}}),function(n){return n.then(e,o)}}];n.responseInterceptors.push(t)}]),angular.module("tt.Authentication.Internal",[]).factory("httpBuffer",["$injector",function(n){function r(t,r){function u(n){r.resolve(n)}function f(n){r.reject(n)}t.config?(i=i||n.get("$http"),i(t.config).then(u,f)):$.ajax(t).then(u,f)}var t=[],i;return{append:function(n,i){t.push({data:n,deferred:i})},retry:function(){for(var n=0;n<t.length;++n)r(t[n].data,t[n].deferred);t=[]}}}]);
//@ sourceMappingURL=authentication.min.js.map