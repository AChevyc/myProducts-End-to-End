angular.module("tt.Authentication.Services",["tt.Authentication.Internal"]).factory("authService",["$rootScope","$injector","$q","httpBuffer",function(n,t,i,r){function c(n,i){var r="Basic "+Base64.encode(n+":"+i);u=u||t.get("$http"),u.defaults.headers.common.Authorization=r,u.get(ttTools.baseUrl+"api/token").success(function(t){n="",i="",r="",h(t),s()})}function s(){o=0,n.$broadcast("tt:authNConfirmed"),r.retry()}function h(n){var r=(new Date).getTime()+(n.expires_in-5)*1e3,i="Session "+n.access_token;u=u||t.get("$http"),u.defaults.headers.common.Authorization=i,$(document).ajaxSend(function(n,t){t.setRequestHeader("Authorization",i)}),n.expiration=r,f.save({key:e,token:n},"")}function l(){var n=i.defer();return f.get(e,function(t){n.resolve(t)}),n.promise}var u,f=new Lawnchair({adapter:"dom",table:"authenticationToken"},function(){}),e="tt:authNToken",o=0;return{requestAttempts:o,authenticate:c,authenticationSuccess:s,setToken:h,getToken:l}}]),angular.module("tt.Authentication.Providers",["tt.Authentication.Services","tt.Authentication.Internal"]).config(["$httpProvider",function(n){var t=["$rootScope","$q","authService","httpBuffer",function(n,t,i,r){function f(n){return n}function e(r){if(r.status===401){var f=t.defer();return i.requestAttempts>0?n.$broadcast("tt:authNRequired"):(i.requestAttempts++,u(r,f)),f.promise}return t.reject(r)}function u(t,u){i.getToken().then(function(f){return r.append(t,u),f?(new Date).getTime()>f.token.expiration?(n.$broadcast("tt:authNRequired"),u.promise):(i.setToken(f.token),r.retry(),u.promise):(n.$broadcast("tt:authNRequired"),u.promise)})}return $.ajaxPrefilter(function(t){var r=t.error,f=t;t.error=function(t,e,o){if(t.status===401){var s=$.Deferred();return i.requestAttempts>0?n.$apply(n.$broadcast("tt:authNRequired")):(i.requestAttempts++,n.$apply(u(f,s))),s.promise}return r(t,e,o)}}),function(n){return n.then(f,e)}}];n.responseInterceptors.push(t)}]),angular.module("tt.Authentication.Internal",[]).factory("httpBuffer",["$injector",function(n){function r(t,r){function u(n){r.resolve(n)}function f(n){r.reject(n)}t.config?(i=i||n.get("$http"),i(t.config).then(u,f)):$.ajax(t).then(u,f)}var t=[],i;return{append:function(n,i){t.push({data:n,deferred:i})},retry:function(){for(var n=0;n<t.length;++n)r(t[n].data,t[n].deferred);t=[]}}}]);
//@ sourceMappingURL=authentication.min.js.map